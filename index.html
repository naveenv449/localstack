<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S3 Browser</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center">S3 Bucket Browser</h2>
        <div class="mb-3">
            <select class="form-select" id="bucket-select">
                <option selected>Select a Bucket</option>
            </select>
        </div>
        <ul class="list-group" id="keys-list"></ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    fetch('/buckets')
        .then(response => response.json())
        .then(buckets => {
            const bucketSelect = document.getElementById('bucket-select');
            buckets.forEach(bucket => {
                const option = document.createElement('option');
                option.value = bucket;
                option.textContent = bucket;
                bucketSelect.appendChild(option);
            });

            bucketSelect.addEventListener('change', function() {
                const selectedBucket = this.value;
                fetchKeys(selectedBucket, '');
            });
        });

    function fetchKeys(bucketName, prefix) {
        fetch(`/buckets/${bucketName}/keys?prefix=${encodeURIComponent(prefix)}`)
            .then(response => response.json())
            .then(data => {
                const keysList = document.getElementById('keys-list');
                keysList.innerHTML = '';

                // Add folders (prefixes)
                data.prefixes.forEach(prefixObj => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item list-group-item-action';
                    const prefixName = prefixObj.Prefix;
                    listItem.textContent = prefixName;
                    listItem.addEventListener('click', function() {
                        fetchKeys(bucketName, prefixName);
                    });
                    keysList.appendChild(listItem);
                });

                // Add files
                data.files.forEach(fileObj => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item';
                    const fileName = fileObj.Key;
                    if (fileName !== prefix) {  // Avoid listing the folder itself
                        listItem.textContent = fileName.split('/').pop();
                        listItem.addEventListener('click', function() {
                            window.location.href = `/buckets/${bucketName}/keys/${encodeURIComponent(fileName)}/download`;
                        });
                        keysList.appendChild(listItem);
                    }
                });
            });
    }
});

    </script>
</body>
</html>
